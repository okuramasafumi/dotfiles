stty stop undef
stty start undef

# direnv export here so that it doesn't print warnings about p10k instant prompt
if type direnv > /dev/null 2>&1; then
  emulate zsh -c "$(direnv export zsh)"
fi

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# zshrc

# Load uitily function
autoload -Uz is-at-least

# Config directory
ZSH_DIR="$HOME/.zsh"

# Remove dups from paths
typeset -aU path cdpath fpath manpath

autoload -Uz zmv

# cdr
if is-at-least 4.3.11; then
  autoload -Uz chpwd_recent_dirs cdr add-zsh-hook
  add-zsh-hook chpwd chpwd_recent_dirs
  zstyle ":chpwd:*" recent-dirs-max 500
  zstyle ":chpwd:*" recent-dirs-defalut true
  zstyle ":completion:*" recent-dirs-insert always
fi

### Added by Zinit's installer
if [[ -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
  source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
  autoload -Uz _zinit
  (( ${+_comps} )) && _comps[zinit]=_zinit

# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
  zdharma-continuum/zinit-annex-as-monitor \
  zdharma-continuum/zinit-annex-bin-gem-node \
  zdharma-continuum/zinit-annex-patch-dl \
  zdharma-continuum/zinit-annex-rust

zinit ice as"completion"
zinit light zsh-users/zsh-completions
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-apple-touchbar
zinit light zdharma-continuum/fast-syntax-highlighting
zinit ice depth"1"
zinit light romkatv/powerlevel10k
zinit light okuramasafumi/zsh-sensible
zinit light vasyharan/zsh-brew-services
zinit light scriptingosx/mac-zsh-completions

# For git and fzf
zinit snippet https://gist.githubusercontent.com/okuramasafumi/9b5eb54850fc4a15813a1d4f87ff85fb/raw/addd40ccd9eabda9c678533daf9fa73adac41b7c/fzf-git.zsh

zinit ice as"program" pick"bin/git-fuzzy"
zinit light bigH/git-fuzzy

zinit light MichaelAquilina/zsh-you-should-use

[ -e /usr/local/share/zsh/site-functions ] && zinit creinstall -Q /usr/local/share/zsh/site-functions
fi

### End of Zinit's installer chunk

# Add some completions (we need this before compinit)
[ -e /usr/local/share/zsh/site-functions ] && fpath=(/usr/local/share/zsh/site-functions $fpath)

[ -e $ZSH_DIR/completions ] && fpath=($ZSH_DIR/completions $fpath)

# The most important feature of zsh
# It's so slow that we want to do it once a day
autoload -Uz compinit
for dump in ~/.zcompdump(N.mh+24); do
  compinit
done
compinit -C

for config ($ZSH_DIR/*.zsh) do source $config; done

# bindkey -M emacs '^P' history-substring-search-up
# bindkey -M emacs '^N' history-substring-search-down

bindkey -e

[ -f /usr/local/share/chruby/chruby.sh ] && source /usr/local/share/chruby/chruby.sh
[ -f /usr/local/share/chruby/auto.sh ] && source /usr/local/share/chruby/auto.sh

eval "$(fnm env)" # fnm for nodejs version management

if [[ -a ~/.zshrc.local ]]; then
  source ~/.zshrc.local
fi

# direnv
if type direnv > /dev/null 2>&1; then
  emulate zsh -c "$(direnv hook zsh)"
fi

# the fuck
if type thefuck > /dev/null 2>&1; then
  eval "$(thefuck --alias)"
fi

# Reload path to remove dups
path=($path)

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
